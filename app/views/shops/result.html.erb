<div class="max-w-3xl mx-auto mt-12">
  <h2 class="text-2xl font-bold mb-4">Ê§úÁ¥¢ÁµêÊûú</h2>

  <!-- Google Maps Ë°®Á§∫ 
  <div id="map" style="width: 100%; height: 400px;"></div>-->

  <script>
    function initMap() {
      const shops = <%= raw @shops.to_json %>;

      if (shops.length === 0) {
        const defaultCenter = { lat: 35.681236, lng: 139.767125 };
        const map = new google.maps.Map(document.getElementById("map"), {
          zoom: 15,
          center: defaultCenter,
        });
        return;
      }

      const map = new google.maps.Map(document.getElementById("map"), {
        zoom: 15,
        center: { lat: shops[0].lat, lng: shops[0].lng },
      });

      shops.forEach(shop => {
        const position = new google.maps.LatLng(shop.lat, shop.lng);
        const marker = new google.maps.Marker({
          position: position,
          map: map,
          title: shop.name
        });

        const infoWindow = new google.maps.InfoWindow({
          content: `<div><strong>${shop.name}</strong><br>${shop.address}</div>`
        });

        marker.addListener("click", () => {
          infoWindow.open(map, marker);
        });
      });
    }

    document.addEventListener("turbo:load", () => {
      if (typeof initMap === "function") {
        initMap();
      }
    });
  </script>

  <script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAPS_API_KEY'] %>&callback=initMap" async defer></script>

  <% if @shops.present? %>
    <% @shops.each do |shop| %>
      <!-- data-turbo="false" „ÇíËøΩÂä† -->
      <%= link_to shop_path(shop[:place_id]), data: { turbo: false }, class: "block p-4 mb-4 bg-white rounded shadow hover:bg-gray-100 transition" do %>
        <p class="text-lg font-semibold"><%= shop[:name] %></p>
        <p class="text-gray-600"><%= shop[:address] %></p>
        <% if shop[:rating] %>
          <p>Ë©ï‰æ°: <%= shop[:rating] %> ‚≠ê</p>
        <% end %>
      <% end %>
    <% end %>

    <!-- „Éö„Éº„Ç∏„É≥„Ç∞„É™„É≥„ÇØ -->
    <div class="mt-6 mb-8 flex justify-center">
      <%= paginate @shops %>
    </div>
  <% else %>
    <p>Â∫óËàó„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ</p>
  <% end %>
</div>

<div class="flex justify-center items-center space-x-4 mt-4 mb-6">
  <%= link_to "üîç Êñ∞„Åó„ÅèÊ§úÁ¥¢„Åô„Çã", search_shops_path,
      data: { turbo: false },
      class: "px-4 py-2 bg-white border border-gray-300 rounded-full text-gray-700 hover:bg-gray-100 hover:border-gray-400 transition font-semibold" %>
</div>
